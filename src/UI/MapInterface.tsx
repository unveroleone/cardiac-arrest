import '../assets/MapInterface.css';

type ClickablePoints = {
    boss: boolean;
    enemy1: boolean; // now bottom
    enemy2: boolean;
    enemy3: boolean; // now just below boss
};

type MapInterfaceProps = {
    onEnemyClick: (id: string) => void;
    clickablePoints: ClickablePoints;
    setClickablePoints?: (points: ClickablePoints) => void;
};

function MapInterface({ onEnemyClick, clickablePoints }: MapInterfaceProps) {
    const r = 20;

    const points = {
        boss: { x: 200, y: 40 },
        enemy3: { x: 160, y: 180 }, // ⬅ used to be enemy1
        enemy2: { x: 240, y: 280 },
        enemy1: { x: 200, y: 380 }  // ⬅ used to be enemy3
    };

    const handleClick = (id: string) => {
        if (clickablePoints[id as keyof typeof clickablePoints]) {
            onEnemyClick(id);
        }
    };

    const getEnemyOpacity = (id: keyof typeof clickablePoints) => {
        return clickablePoints[id] ? '1' : '0.5';
    };

    const renderEnemy = (id: keyof typeof points) => {
        const { x, y } = points[id];
        const isClickable = clickablePoints[id as keyof typeof clickablePoints];
        return (
            <g
                key={id}
                className={isClickable ? 'clickable' : ''}
                transform={`translate(${x - r}, ${y - r})`}
                onClick={() => handleClick(id)}
                style={{
                    pointerEvents: isClickable ? 'auto' : 'none',
                    cursor: isClickable ? 'pointer' : 'default',
                }}
            >
                <circle cx={r} cy={r} r={r} stroke={isClickable ? "red" : "grey"} strokeWidth="4" fill="none" />
                <circle cx={r} cy={r} r={r-5} fill="transparent" stroke="transparent" className="map-hitbox" />
                <svg 
                    x={r - 15} 
                    y={r - 15} 
                    width="30" 
                    height="30" 
                    viewBox="0 0 512 512"
                    style={{ filter: isClickable ? 'none' : 'grayscale(100%)' }}
                >
                    <path 
                        fill={isClickable ? "red" : "grey"} 
                        d="M256 23.906a134.338 134.338 0 0 0-3.395 4.314l-19.029 146.516c5.906 4.289 14.005 6.869 22.424 6.869 8.419 0 16.518-2.58 22.424-6.87L259.394 28.22A134.338 134.338 0 0 0 256 23.906zM52.197 82.993c2.633 4.83 5.372 10.094 8.059 15.832 9.706 20.733 19.502 45.58 12.256 66.7-4.893 14.26-18.833 21.828-30.762 27.916-4.115 2.1-7.915 3.778-11.395 5.244 2.888 3.986 6.193 8.714 9.625 14.222 8.46 13.576 17.636 29.8 17.012 46.043-.763 19.865-13.95 39.996-26.19 56.64-1.306 1.777-2.539 3.276-3.827 4.95 14.02-4.176 27.872-7.632 41.064-8.894 16.829-1.61 33.403.825 46.463 10.033a32.098 32.098 0 0 1 4.508-4.094c.01-9.985.11-22.057 1.045-35.396-11.958-1.312-21.933-1.398-32.496 6.494l-7.21 5.387-10.77-14.418 7.208-5.387c11.648-8.702 23.651-10.752 34.836-10.611.746.009 1.489.029 2.227.056 2.72.102 5.365.332 7.96.596 1.037-8.072 2.45-16.309 4.395-24.494-14.211-9.95-35.149-20.405-54.865-20.914l-8.996-.23.465-17.993 8.996.23c22.807.59 43.924 10.096 59.771 20.536 2.512-7.092 5.556-14.02 9.235-20.586-13.379-16.006-31.274-34.787-44.903-42.313l-7.879-4.35 8.701-15.755 7.877 4.35c16.791 9.271 33.688 26.7 46.89 42.447 3.375-4.048 7.1-7.842 11.241-11.293.482-.401.983-.783 1.475-1.174-28.886-34.842-70.211-71.854-112.016-89.774zm407.606 0c-41.805 17.92-83.13 54.932-112.016 89.774.492.391.993.773 1.475 1.174 4.14 3.45 7.866 7.244 11.242 11.29 13.202-15.745 30.098-33.173 46.889-42.445l7.877-4.35 8.7 15.757-7.878 4.35c-13.629 7.525-31.524 26.306-44.903 42.312 3.68 6.567 6.723 13.494 9.235 20.586 15.847-10.44 36.964-19.947 59.771-20.535l8.996-.23.465 17.991-8.996.23c-19.716.51-40.654 10.965-54.865 20.915 1.945 8.185 3.358 16.423 4.394 24.494 2.596-.264 5.24-.494 7.961-.596a89.93 89.93 0 0 1 2.227-.056c11.185-.14 23.188 1.909 34.836 10.61l7.209 5.388-10.772 14.418-7.209-5.387c-10.563-7.892-20.538-7.806-32.496-6.494.935 13.339 1.035 25.411 1.045 35.396a32.098 32.098 0 0 1 4.508 4.094c13.06-9.208 29.634-11.644 46.463-10.033 13.192 1.262 27.044 4.718 41.064 8.894-1.288-1.674-2.52-3.173-3.828-4.95-12.238-16.643-25.426-36.775-26.19-56.64-.623-16.244 8.552-32.467 17.013-46.042 3.432-5.509 6.737-10.237 9.625-14.223-3.48-1.466-7.28-3.144-11.395-5.244-11.929-6.088-25.869-13.655-30.762-27.916-7.246-21.12 2.55-45.967 12.256-66.7 2.687-5.738 5.426-11.002 8.059-15.832zm-234.217 13.53c-1.177 2.384-2.353 4.77-3.56 7.152-10.007 19.736-20.462 38.716-30.81 54.79 8.155-2.615 17.135-4.239 26.936-4.706zm60.828 0l7.434 57.236c9.801.467 18.78 2.09 26.935 4.705-10.347-16.073-20.802-35.053-30.808-54.789-1.208-2.382-2.384-4.768-3.56-7.152zm-70.62 75.386c-17.966 1.358-31.163 7.219-41.532 15.86-11.888 9.907-20.144 23.874-25.776 39.83-9.606 27.217-11.13 59.203-11.379 82.982a46.752 46.752 0 0 1 6.19-.47c6.381-.049 12.665 1.167 18.584 3.21 11.837 4.088 22.782 11.155 33.53 18.495 21.493 14.678 42.256 29.789 60.589 29.789s39.096-15.11 60.59-29.79c10.747-7.339 21.692-14.406 33.53-18.493 7.825-2.703 16.288-3.941 24.773-2.74-.25-23.78-1.773-55.766-11.38-82.983-5.63-15.956-13.887-29.923-25.775-39.83-10.369-8.641-23.566-14.502-41.533-15.86l1.29 9.928-3.132 3.131C284.243 195.089 270 199.605 256 199.605s-28.242-4.516-38.363-14.637l-3.131-3.13zm-27.628 45.28c.574-.008 1.155.006 1.744.04 1.346.082 2.731.281 4.158.618 18.589 4.388 30.298 22.616 39.467 38.57 9.17 15.954 14.875 30.985 14.875 30.985l3.203 8.408-16.322 6.219a775.756 775.756 0 0 1 4.709 4.576c-16 16-64 0-80-16 0-16 0-32 16-32 12.758 0 45.503 30.193 58.395 42.56l-2.805-7.357s-5.318-13.907-13.66-28.422c-8.343-14.515-20.634-28.285-27.998-30.023-.192-.046-7.454 1.83-13.31 5.714-5.858 3.884-10.532 8.155-10.532 8.155l-6.627 6.088-12.178-13.252 6.625-6.09s5.523-5.1 12.764-9.9c5.94-3.94 12.886-8.769 21.492-8.89zm135.668 0c8.606.12 15.552 4.95 21.492 8.888 7.241 4.802 12.764 9.9 12.764 9.9l6.625 6.09-12.178 13.253-6.627-6.088s-4.674-4.27-10.531-8.155c-5.857-3.883-13.12-5.76-13.31-5.714-7.365 1.738-19.656 15.508-27.999 30.023-8.342 14.515-13.66 28.422-13.66 28.422l-2.805 7.357c12.892-12.367 45.637-42.56 58.395-42.56 16 0 16 16 16 32-16 16-64 32-80 16 0 0 1.99-1.955 4.709-4.576l-16.322-6.22 3.203-8.407s5.705-15.03 14.875-30.985c9.17-15.954 20.878-34.182 39.467-38.57a24.473 24.473 0 0 1 4.158-.617c.589-.036 1.17-.05 1.744-.041zM240 316.605v22h-16zm32 0l16 22h-16zm-128.42 11.351c-3.928.01-7.735.878-11.705 2.772-4.352 2.076-7.826 7.184-9.83 14.672-2.004 7.487-2.22 16.729-1.147 23.867 6.332 42.105 37.42 85.884 75.22 105.336 34.955 17.989 84.809 17.989 119.765 0 37.799-19.452 68.887-63.23 75.219-105.336 1.073-7.138.857-16.38-1.147-23.867-2.004-7.488-5.478-12.596-9.83-14.672-7.94-3.788-15.232-3.468-24.13-.395-8.9 3.073-18.839 9.233-29.255 16.346-20.832 14.227-43.505 32.926-70.74 32.926-27.235 0-49.908-18.7-70.74-32.926-10.416-7.113-20.356-13.273-29.254-16.346-4.45-1.536-8.498-2.386-12.426-2.377zm7.42 28.088l11.975 5.987L176 394.55l15.96-18.196c5.902 2.85 11.374 5.433 16.405 7.693l11.465 18.557 6.395-11.205c11.472 4.172 20.813 6.205 29.775 6.205s18.303-2.033 29.775-6.205l6.395 11.205 11.465-18.557c5.03-2.26 10.503-4.843 16.404-7.693L336 394.55l13.025-32.52L361 356.045v14.56c0 11-4.744 23.841-13.512 36.993a105.125 105.125 0 0 1-19.896 22.191L320 414.605l-21.594 32.39a120.352 120.352 0 0 1-14.775 4.88l-6.166-21.27-13.844 24.572c-5.079.36-10.163.36-15.242 0l-13.844-24.572-6.166 21.27a120.352 120.352 0 0 1-14.775-4.88L192 414.605l-7.592 15.183a105.125 105.125 0 0 1-19.896-22.191C155.744 394.445 151 381.604 151 370.605z"
                />
            </svg>
            </g>
        );
    };

    return (
        <div className="Map">
            <svg width="600" height="600" viewBox="0 0 400 500">
                {/* Lines (now connecting boss -> enemy3 -> enemy2 -> enemy1) */}
                <line x1={points.boss.x} y1={points.boss.y + r + 9} x2={points.enemy3.x} y2={points.enemy3.y - r} stroke="black" strokeWidth="4" strokeDasharray="10,6" />
                <line x1={points.enemy3.x} y1={points.enemy3.y + r} x2={points.enemy2.x} y2={points.enemy2.y - r} stroke="black" strokeWidth="4" strokeDasharray="10,6" />
                <line x1={points.enemy2.x} y1={points.enemy2.y + r} x2={points.enemy1.x} y2={points.enemy1.y - r} stroke="black" strokeWidth="4" strokeDasharray="10,6" />

                {/* Boss */}
                <g
                    transform={`translate(${points.boss.x - (r + 10)}, ${points.boss.y - (r + 10)})`}
                    onClick={() => handleClick('boss')}
                    style={{
                        pointerEvents: clickablePoints.boss ? 'auto' : 'none',
                        cursor: 'pointer'
                    }}
                >
                    <circle cx={r + 10} cy={r + 10} r={r + 10} stroke={clickablePoints.boss ? "red" : "grey"} strokeWidth="4" fill="none" />
                    <circle cx={r + 10} cy={r + 10} r={r + 25} fill="transparent" stroke="transparent" />
                    <svg 
                        x={r + 10 - 25} 
                        y={r + 10 - 25} 
                        width="50" 
                        height="50" 
                        viewBox="0 0 64 64" 
                        xmlns="http://www.w3.org/2000/svg" 
                        preserveAspectRatio="xMidYMid meet"
                        style={{ filter: clickablePoints.boss ? 'none' : 'grayscale(100%)' }}
                    >
                        <path 
                            fill={clickablePoints.boss ? "red" : "grey"}
                            fill-rule="evenodd" 
                            d="M59.293 23.164c-3.679-5.415-5.014-10.048-3.857-13.4c1.259-3.653 5.135-4.867 5.219-4.894c.757-.222 1.195-1.028.981-1.805a1.424 1.424 0 0 0-1.764-1.01c-.216.063-5.338 1.599-7.118 6.696c-1.517 4.345-.105 9.756 4.193 16.085c1.846 2.715 2.53 5.439 2.037 8.099c-.226 1.215-.681 2.327-1.236 3.321C55.453 17.094 40.503 6.296 32 6.296c-6.544 0-23.381 8.967-25.766 29.935c-.545-.98-.991-2.077-1.216-3.278c-.499-2.665.185-5.396 2.034-8.117c4.299-6.329 5.709-11.741 4.193-16.085c-1.78-5.097-6.901-6.632-7.117-6.695a1.424 1.424 0 0 0-1.764 1.01c-.215.778.227 1.586.986 1.806c.039.011 3.915 1.172 5.205 4.865c1.172 3.354-.158 7.997-3.848 13.427c-2.306 3.393-3.145 6.873-2.494 10.342c.571 3.047 2.199 5.518 3.743 7.271c-.003.307-.018.604-.015.915c.035 3.948.232 13.962 2.221 15.614c1.992 1.656 6.927-2.59 9.255-1.471c2.407 1.157 3.24 5.514 5.867 6.094c2.661.592 5.978-2.854 8.714-2.853c2.734-.001 6.056 3.446 8.717 2.854c2.623-.582 3.46-4.939 5.867-6.096c2.328-1.117 7.259 3.127 9.253 1.471c1.988-1.652 2.186-11.666 2.219-15.614c.003-.308-.01-.607-.014-.911c1.544-1.755 3.174-4.227 3.745-7.275c.652-3.468-.187-6.947-2.492-10.341M32 15.429c8.035 0 10.874 2.103 10.267 3.202c-1.276 2.308-2.232.457-10.267.457s-8.993 1.851-10.268-.457c-.607-1.099 2.233-3.202 10.268-3.202M17.195 51.273c-.677 1.428-3.292 1.559-5.837.291c-2.547-1.27-4.061-3.453-3.382-4.883c.678-1.428 3.292-1.559 5.837-.289c2.545 1.268 4.059 3.454 3.382 4.881m3.162-6.777c-4.665-2.244-10.058-.161-6.75-8.151c1.071-2.588 5.524-.345 9.589 2.434c-1.299.515-2.236 1.851-2.236 3.429c0 2.025 1.523 3.664 3.398 3.664s3.396-1.639 3.396-3.664c0-.008-.004-.018-.004-.027a76.246 76.246 0 0 0-4.492-3.358c3.795 2.603 7.233 5.653 7.233 5.653c-2.078 5.015-5.471 2.266-10.134.02m1.376-18.852c-.608-1.1 2.232-3.201 10.268-3.201c8.035 0 10.874 2.101 10.267 3.201c-1.277 2.306-2.233.457-10.268.457s-8.993 1.849-10.267-.457m13.904 19.123s.705-1.338 1.8-3.2a3.868 3.868 0 0 0-.062.641c0 2.025 1.521 3.664 3.396 3.664s3.396-1.639 3.396-3.664c0-2.021-1.521-3.66-3.396-3.66c-.691 0-1.335.225-1.867.606c-.254.403-.497.796-.729 1.179c3.067-5.048 8.118-12.275 10.532-9.669c3.604 3.885 3.613 10.209.002 14.104c-3.61 3.894-9.472 3.884-13.072-.001M52.641 51.564c-2.546 1.268-5.16 1.137-5.839-.291c-.675-1.428.837-3.613 3.384-4.881c2.546-1.27 5.159-1.139 5.837.289c.678 1.43-.835 3.614-3.382 4.883"
                        ></path>
                    </svg>
                </g>

                {/* Enemies */}
                {renderEnemy('enemy3')}
                {renderEnemy('enemy2')}
                {renderEnemy('enemy1')}
            </svg>
        </div>
    );
}

export default MapInterface;